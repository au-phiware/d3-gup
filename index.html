<!DOCTYPE html>
<html>
<head>
  <title>d3-gup</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" media="all" href="docco.css" />
  <link rel="stylesheet" href="solarized-dark.css" />
  <link rel="stylesheet" href="examples.css" />
</head>
<body class="solarized-dark">
  <a href="https://github.com/au-phiware/d3-gup">
    <img class="gh-ribbon"
     src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png">
  </a>
  <div id="container">
    <div id="background"></div>

    <ul class="sections">
      <li id="title">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#title">&#182;</a>
          </div>
          <h1>d3-gup</h1>
        </div>
      </li>

      <li id="badges">
        <div class="annotation">
          <a href="https://opensource.org/licenses/BSD-3-Clause">
            <img class="badge"
              src="https://img.shields.io/npm/l/d3-gup.svg">
          </a>
          <a href="https://www.npmjs.com/package/d3-gup">
            <img class="badge"
              src="https://img.shields.io/npm/v/d3-gup.svg">
          </a>
        </div>
        <div class="content"><div class='highlight'>
          <pre><code class="sh">npm install --save d3-gup</code></pre>
        </div></div>
      </li>

      <li id="introduction">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#introduction">&#182;</a>
          </div>
          <h1>Introduction</h1>
        </div>
      </li>

      <li id="intro-10">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#intro-10">&#182;</a>
          </div>
          <p>d3-gup is a functional and composable D3 plugin that
          codifies the <a
            href="https://bl.ocks.org/mbostock/3808218"
            title="General Update Pattern, I">General Update Pattern</a>
          as described by <a
            href="https://github.com/d3/d3-selection#selection_data"
            title="Selection#data (d3-selection)">Selection#data</a>.
          It does not attempt to wrap D3 or provide abstractions to replace or
          conceal the existing D3 features.  Instead it provides the facilities
          for composition of sets of functions to aid in the construction of
          components.  d3-gup is aware of D3 transitions and takes the
          appropriate actions in response to them.
          </p>
        </div>
      </li>

      <li id="intro-20">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#intro-20">&#182;</a>
          </div>
          <a href="https://github.com/au-phiware/d3-gup">Fork me</a>
          on GitHub.
          <a href="https://github.com/au-phiware/d3-gup/network/members">
            <img alt="GitHub Forks" class="badge"
                 src="https://img.shields.io/github/forks/au-phiware/d3-gup.svg?style=social&label=Forks">
          </a>
          </p>
        </div>
        
        <div class="content"><div class='highlight'>
          <pre><code class="sh"
            >git clone https://github.com/au-phiware/d3-gup.git</code></pre>
        </div></div>
      </li>

      <!--
      <li id="intro-30">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#intro-30">&#182;</a>
          </div>
          <p>Run the <a href="spec/index.html">test suite</a> and gauge its
          <a href="coverage/Chrome%2043.0.2357%20(Linux%200.0.0)/d3-gup/index.html"
            >coverage</a>.
          <a href="https://travis-ci.org/au-phiware/d3-gup">
            <img alt="Build status" class="badge"
                 src="https://api.travis-ci.org/au-phiware/d3-gup.svg?branch=master">
          <a href="https://codecov.io/github/au-phiware/d3-gup">
            <img alt="Coverage via Codecov" class="badge"
                 src="https://codecov.io/gh/au-phiware/d3-gup/branch/master/graph/badge.svg">
          </a>
          </p>
        </div>
        <div class="content"><div class='highlight'>
          <pre><code class="sh"
            >npm test</code></pre>
        </div></div>
      </li>
      -->

      <li id="intro-40">
        <div class="annotation">
          <div class="pilwrap ">
            <a class="pilcrow" href="#intro-40">&#182;</a>
          </div>
          <p>To truly understand d3-gup read the
          <a href="src/gup.html">annotated source code</a>.</p>
        </div>
        <div class="content"><div class='highlight'>
          <pre><code class="sh"
            >more src/gup.js src/compose.js</code></pre>
        </div></div>
      </li>

      <li id="intro-99">
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#intro-99">&#182;</a>
          </div>
          <p>Perhaps the best way to explain d3-gup is by example.</p>
        </div>
      </li>

      <li id="examples">
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#examples">&#182;</a>
          </div>
          <h1>Examples</h1>
          <h2>Canonical</h2>
        </div>
      </li>

      <li id="examples-canonical">
        <div class="annotation">
          <p>The following examples are reproductions of <a
            href="https://bl.ocks.org/mbostock"
            title="Mike Bostock's Blocks">Mike Bostock's</a>
          General Update Pattern examples.  They are presented here so that you
          may compare how d3-gup relates to the conventional approach.</p>
          <p>The global helpers to the right are used for each example.</p>
        </div>

        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>var examples = [];
var alphabet = "abcdefghijklmnopqrstuvwxyz".split("");

function randomSample(data) {
  return d3.shuffle(data)
    .slice(0, Math.floor(Math.random() * data.length))
    .sort();
}</code></pre>
          </div>
        </div>
      </li>

      <li class="example">
        <div><span>Example 1</span></div>
        <div class="annotation">
          <p><em>This example is a reproduction of <a
             href="https://bl.ocks.org/mbostock/3808218"
             title="Mike Bostock's Block 3808218"
             >General Update Pattern, I</a>.</em></p>
          <p>In this example we create a GUP factory that can be bound to data,
          which produces a GUP instance. A GUP instance can be called against a
          D3 selection, which preforms a data-join and executes a set of update
          functions.</p>
          <p>The GUP factory is rebound to random letters of the alphabet and
          called at regular intervals in a D3 timer.</p>
        </div>
        <div class="content">
          <svg id="example-1"></svg>
          <div class='highlight'>
            <pre><code class="javascript"
>examples[0] = {
  timer: d3.interval(
    () => examples[0].root.call(
      examples[0].gup(randomSample(alphabet))
    ), 1500),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p>The GUP instance is called on a D3 selection that contains a single
          <code>g</code> element inside a <code>svg</code> element.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>  root: d3.select("svg#example-1")
    .attr("width", 450)
    .attr("height", 100)
    .append("g")
    .attr("transform", "translate(16 50)"),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p>This creates our GUP factory, ready to configure with our phase
          functions.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>  gup: d3.gup()</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p><code>select</code> occurs prior to the data-join; here we select
          old <code>text</code> elements, if any.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .select($ => $.selectAll("text"))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p><code>pre</code> is applied to old elements; <code>update</code>
          class colours them blue.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .pre($ => $.attr("class", "update"))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p><code>enter</code> creates new elements as needed;
          <code>enter</code> class colours them green.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .enter($ => $.append("text")
      .attr("class", "enter")
      .attr("dy", ".35em")
      .attr("x", (d, i) => i * 16))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p><code>post</code> is applied to the merged set of new and old
          elements; here we lay them out in a line.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .post($ => $.text(d => d))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-1">&#182;</a>
          </div>
          <p><code>exit</code> is applied to elements that no longer have bound
          data; here we simply remove them.</p>
          <p>The overall effect is that we see green letters when the list grows
          and only blue letters when the list shrinks.  The association between
          individual letters and their colour is lost because no key function is
          specified whilst binding the data.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .exit($ => $.remove())
};</code></pre>
          </div>
        </div>
      </li>

      <li class="example">
        <div><span>Example 2</span></div>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-2">&#182;</a>
          </div>
          <p><em>This example is a reproduction of <a
             href="https://bl.ocks.org/mbostock/3808221"
             title="Mike Bostock's Block 3808221"
             >General Update Pattern, II</a>.</em></p>
          <p>In this example we provide the key function that was missing from
          the previous example.</p>
          <p>As before, we setup a D3 timer to a <code>g</code> element but this
          time the identity function is passed as the key function when the data
          is bound to the GUP.</p>
        </div>
        <div class="content">
          <svg id="example-2"></svg>
          <div class='highlight'>
            <pre><code class="javascript"
>examples[1] = {
  timer: d3.interval(
    () => examples[1].root.call(
      examples[1].gup(randomSample(alphabet), d => d)
    ), 1500),

  root: d3.select("#example-2")
    .attr("width", 450)
    .attr("height", 100)
    .append("g")
    .attr("transform", "translate(16 50)"),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-2">&#182;</a>
          </div>
          <p>As before, we create our GUP and configure it. No change to
          <code>select</code> or <code>pre</code> either.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>  gup: d3.gup()
    .select($ => $.selectAll("text"))
    .pre($ => $.attr("class", "update"))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-2">&#182;</a>
          </div>
          <p><code>enter</code> is where the <code>text</code> content is
          applied since it will remain constant, by virtue of the key
          function.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .enter($ => $.append("text")
      .attr("class", "enter")
      .attr("dy", ".35em")
      .text(d => d))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-2">&#182;</a>
          </div>
          <p>However, the elements will change position in the list (agian,
          thanks to the key function), thus <code>post</code> is where we set
          the horizontal position.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .post($ => $.attr("x", (d, i) => i * 16))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-2">&#182;</a>
          </div>
          <p>No change to <code>exit</code>.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .exit($ => $.remove())
};</code></pre>
          </div>
        </div>
      </li>

      <li class="example">
        <div><span>Example 3</span></div>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p><em>This example is a reproduction of <a
              href="https://bl.ocks.org/mbostock/3808234"
              title="Mike Bostock&#39;s Block 3808234"
              >General Update Pattern, III</a>.</em></p>
          <p>In the previous example we provided the key function to communicate
          a sense of object constancy.  This effect is completed with the
          addition of transitions.</p>
          <p>As before, we setup a D3 timer to a <code>g</code> element.</p>
        </div>
        <div class="content">
          <svg id="example-3"></svg>
          <div class='highlight'>
            <pre><code class="javascript"
>examples[2] = {
  timer: d3.interval(
    () => examples[2].root.call(
      examples[2].gup(randomSample(alphabet), d => d)
    ), 1500),

  root: d3.select("#example-3")
    .attr("width", 450)
    .attr("height", 100)
    .append("g")
    .attr("transform", "translate(16 50)")</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p>The <code>g</code> element is created the same way but now we
          introduce a transition.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .transition()
      .duration(750),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p>As before, we create our GUP and configure it.  We must now pay
          closer attention to the elements vertical and horizontal position so
          that it will be animated during the transition and also to the opacity
          to produce fade-in and fade-out effects.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>  gup: d3.gup()
    .select($ => $.selectAll("text"))
    .pre($ => $.attr("class", "update"))
    .enter($ => $.append("text")
      .attr("class", "enter")
      .attr("dy", ".35em")
      .text(d => d))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p>Elements will begin positioned above the list and horizontally
          correct.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>      .attr("y", -60)
      .attr("x", (d, i) => i * 16)
      .style("fill-opacity", 1e-6))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p>Elements final position will be in the list; existing elements will
          traval horizontally.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .post($ => $.attr("x", (d, i) => i * 16)
      .attr("y", 0)
      .style("fill-opacity", 1))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-3">&#182;</a>
          </div>
          <p>Exiting elements will drop below the list and fade out and then
          removed when the transition completes.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    .exit($ => $.attr("class", "exit")
      .attr("y", 60)
      .style("fill-opacity", 1e-6)
      .remove())
};</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <h2 id="composition">Composition</h2>
          <p>Composition allows us to separate concerns into individuals modules
          and then combined them in different ways.  Creating small modules
          promotes greater reuse of software components.</p>
        </div>
      </li>

      <li class="example">
        <div><span>Example 4</span></div>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <p>In this example we reproduce the previous example by reusing the
          GUP created in the second example.</p>
          <p>The only substantial difference is in the construction of the
          GUP.</p>
        </div>
        <div class="content">
          <svg id="example-4"></svg>
          <div class='highlight'>
            <pre><code class="javascript"
>examples[3] = {
  tick() {
    examples[3].root.call(examples[3].gup(randomSample(alphabet), d => d));
  },
  timer: d3.interval(() => examples[3].tick(), 1500),

  root: d3.select("#example-4")
    .attr("width", 450)
    .attr("height", 100)
    .append("g")
    .attr("transform", "translate(16 50)")
    .transition()
      .duration(750),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <p>Two or more GUPs can be composed together with a call to
          <code>gupCompose</code>.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>  gup: d3.gupCompose(</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <p>All the additional logic is contained in its own GUP.</p>
          <p>The rightmost GUP will be the innermost call and hence the first to
          be executed.  This is particularly important for the enter phase where
          the element must be created before anything else.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    d3.gup()
      .enter($ => $
        .attr("y", -60)
        .attr("x", (d, i) => i * 16)
        .style("fill-opacity", 1e-6))
      .post($ => $
        .attr("y", 0)
        .style("fill-opacity", 1))</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <p>The <code>remove</code> call can occur at anytime since it is
          deferred until the transition completes.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>      .exit($ => $
        .attr("class", "exit")
        .attr("y", 60)
        .style("fill-opacity", 1e-6)),</code></pre>
          </div>
        </div>
      </li>

      <li>
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#example-4">&#182;</a>
          </div>
          <p>The original GUP is passed untouched.</p>
        </div>
        <div class="content">
          <div class='highlight'>
            <pre><code class="javascript"
>    examples[1].gup
  )
};</code></pre>
          </div>
        </div>
      </li>

      <li id="footer-copy">
        <div class="annotation">
          <div class="pilwrap">
            <a class="pilcrow" href="#footer-copy">&#182;</a>
          </div>
          <p>Copyright &copy; 2018 Corin Lawson.</p>
        </div>
      </li>
    </ul>
  </div>
  <script src="highlight.pack.js"></script>
  <script
    src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
    crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="build/d3-gup.js"></script>
  <script src="examples.js"></script>
  <script src="gh-pages.js"></script>
</body>
</html>
